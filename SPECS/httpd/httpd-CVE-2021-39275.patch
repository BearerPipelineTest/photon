From c69d4cc90c0e27703030b3ff09f91bf4dcbcfd51 Mon Sep 17 00:00:00 2001
From: Stefan Eissing <icing@apache.org>
Date: Tue, 10 Aug 2021 08:55:54 +0000
Subject: [PATCH] Merged r1892012 from trunk:

  *) core: fix ap_escape_quotes for pre-escaped quotes



git-svn-id: https://svn.apache.org/repos/asf/httpd/httpd/branches/2.4.x@1892171 13f79535-47bb-0310-9956-ffa450edef68
---
 server/util.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/server/util.c b/server/util.c
index 143c8fc69a4..0c955e76ec2 100644
--- a/server/util.c
+++ b/server/util.c
@@ -2542,7 +2542,7 @@ AP_DECLARE(char *) ap_escape_quotes(apr_pool_t *p, const char *instring)
      * in front of every " that doesn't already have one.
      */
     while (*inchr != '\0') {
-        if ((*inchr == '\\') && (inchr[1] != '\0')) {
+        while ((*inchr == '\\') && (inchr[1] != '\0')) {
             *outchr++ = *inchr++;
             *outchr++ = *inchr++;
         }




Modified below patch
 - Removed non-executable diffs from CHANGES and STATUS

From ac62c7e7436560cf4f7725ee586364ce95c07804 Mon Sep 17 00:00:00 2001
From: Graham Leggett <minfrin@apache.org>
Date: Sat, 21 Aug 2021 21:35:04 +0000
Subject: [PATCH] Backport:

   *) core: fix ap_escape_quotes substitution logic
      trunk patch: https://svn.apache.org/r1892418
      2.4.x patch: svn merge -c 1892418 ^/httpd/httpd/trunk .
      +1: covener, rpluem, ylavic


git-svn-id: https://svn.apache.org/repos/asf/httpd/httpd/branches/2.4.x@1892511 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES       | 10 ++++++----
 STATUS        |  5 -----
 server/util.c |  7 +++----
 3 files changed, 9 insertions(+), 13 deletions(-)

diff --git a/server/util.c b/server/util.c
index 62515facbea..2a7fdda8e97 100644
--- a/server/util.c
+++ b/server/util.c
@@ -2542,13 +2542,12 @@ AP_DECLARE(char *) ap_escape_quotes(apr_pool_t *p, const char *instring)
      * in front of every " that doesn't already have one.
      */
     while (*inchr != '\0') {
-        while ((*inchr == '\\') && (inchr[1] != '\0')) {
-            *outchr++ = *inchr++;
-            *outchr++ = *inchr++;
-        }
         if (*inchr == '"') {
             *outchr++ = '\\';
         }
+        if ((*inchr == '\\') && (inchr[1] != '\0')) {
+            *outchr++ = *inchr++;
+        }
         if (*inchr != '\0') {
             *outchr++ = *inchr++;
         }
