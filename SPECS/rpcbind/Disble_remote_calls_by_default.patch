Added a new configuration flag --enable-rmtcalls
which will be needed to enable the remote call
functionality.

This also stops rpcbind from opening up random
listening ports.

Signed-off-by: Steve Dickson <steved@redhat.com>


--- a/configure.ac	2021-01-20 12:10:19.777341793 +0530
+++ b/configure.ac	2021-01-20 12:10:44.785342993 +0530
@@ -21,6 +21,10 @@ AC_ARG_ENABLE([warmstarts],
   AS_HELP_STRING([--enable-warmstarts], [Enables Warm Starts @<:@default=no@:>@]))
 AM_CONDITIONAL(WARMSTART, test x$enable_warmstarts = xyes)
 
+AC_ARG_ENABLE([rmtcalls],
+  AS_HELP_STRING([--enable-rmtcalls], [Enables Remote Calls @<:@default=no@:>@]))
+AM_CONDITIONAL(RMTCALLS, test x$enable_rmtcalls = xyes)
+
 AC_ARG_WITH([statedir],
   AS_HELP_STRING([--with-statedir=ARG], [use ARG as state dir @<:@default=/tmp@:>@])
   ,, [with_statedir=/tmp])
--- a/Makefile.am	2021-01-20 12:12:00.013346605 +0530
+++ b/Makefile.am	2021-01-20 12:12:19.069347520 +0530
@@ -29,6 +29,10 @@ if LIBWRAP
 AM_CPPFLAGS +=	-DLIBWRAP
 endif
 
+if RMTCALLS
+AM_CPPFLAGS += -DRMTCALLS
+endif
+
 bin_PROGRAMS = rpcbind rpcinfo
 
 rpcbind_SOURCES = \
--- a/src/rpcbind.c	2021-01-20 12:10:53.185343397 +0530
+++ b/src/rpcbind.c	2021-01-20 12:11:42.657345772 +0530
@@ -787,6 +787,8 @@ got_socket:
 		}
 	}
 #endif
+
+#ifdef RMTCALLS
 	/*
 	 * rmtcall only supported on CLTS transports for now.
 	 */
@@ -806,6 +808,7 @@ got_socket:
 		}
 #endif
 	}
+#endif
 	return (0);
 error:
 	close(fd);
