From d2eb78e871153f22332d30c6647f3815148f21e5 Mon Sep 17 00:00:00 2001
From: "W.C.A. Wijngaards" <wouter@nlnetlabs.nl>
Date: Tue, 3 Dec 2019 15:20:48 +0100
Subject: [PATCH] - Fix Assert Causing DoS in dname_pkt_copy(),   reported by
 X41 D-Sec.

Signed-off-by: Shreyas B <shreyasb@vmware.com>
---
 util/data/dname.c | 4 ++++
 1 files changed, 4 insertions(+)

diff --git a/util/data/dname.c b/util/data/dname.c
index 71e14180d..0cca0a4e6 100644
--- a/util/data/dname.c
+++ b/util/data/dname.c
@@ -339,6 +339,10 @@ void dname_pkt_copy(sldns_buffer* pkt, uint8_t* to, uint8_t* dname)
 			lablen = *dname++;
 			continue;
 		}
+		if(lablen > LDNS_MAX_LABELLEN) {
+			*to = 0; /* end the result prematurely */
+			return;
+		}
 		log_assert(lablen <= LDNS_MAX_LABELLEN);
 		len += (size_t)lablen+1;
 		if(len >= LDNS_MAX_DOMAINLEN) {
