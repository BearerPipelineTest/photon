From f5e06689d193619c57c33270c83f5e40781a261d Mon Sep 17 00:00:00 2001
From: "W.C.A. Wijngaards" <wouter@nlnetlabs.nl>
Date: Tue, 3 Dec 2019 15:10:36 +0100
Subject: [PATCH] - Fix Assert Causing DoS in synth_cname(),   reported by X41
 D-Sec.

Signed-off-by: Shreyas B <shreyasb@vmware.com>
---

--- a/iterator/iter_scrub.c	2021-05-05 13:33:19.360191056 +0530
+++ b/iterator/iter_scrub.c	2021-05-05 13:35:52.664698779 +0530
@@ -230,7 +230,11 @@ synth_cname(uint8_t* qname, size_t qname
 	uint8_t* dtarg = NULL;
 	size_t dtarglen;
 	if(!parse_get_cname_target(dname_rrset, &dtarg, &dtarglen, pkt))
-		return 0; 
+		return 0;
+	if(qnamelen <= dname_rrset->dname_len)
+		return 0;
+	if(qnamelen == 0)
+		return 0;
 	log_assert(qnamelen > dname_rrset->dname_len);
 	/* DNAME from com. to net. with qname example.com. -> example.net. */
 	/* so: \3com\0 to \3net\0 and qname \7example\3com\0 */
