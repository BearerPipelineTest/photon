From 71ec7473677ad1ba4812d781e431de64723e5c84 Mon Sep 17 00:00:00 2001
From: Keerthana K <keerthanak@vmware.com>
Date: Wed, 18 Aug 2021 08:18:02 +0000
Subject: [PATCH] iavf: Use PTP_SYS_OFFSET_EXTENDED_IOCTL support

[Srinidhi Rao<srinidhir@vmware.com> regenerated patch for 4.19.205]

Signed-off-by: Keerthana K <keerthanak@vmware.com>
---
 src/kcompat.h                                  | 22 ----------------------
 src/kcompat_std_defs.h                         |  9 ++++++++-
 2 files changed, 8 insertions(+), 23 deletions(-)

diff --git a/src/kcompat.h b/src/kcompat.h
index 25d4f0f..1830d43 100644
--- a/src/kcompat.h
+++ b/src/kcompat.h
@@ -6785,30 +6785,8 @@ _kc_dev_change_flags(struct net_device *netdev, unsigned int flags,
 
 #define dev_change_flags _kc_dev_change_flags
 #endif /* !(RHEL_RELEASE_CODE && RHEL > RHEL(8,0)) */
-#if (RHEL_RELEASE_CODE && \
-     (RHEL_RELEASE_CODE >= RHEL_RELEASE_VERSION(7,7) && \
-      RHEL_RELEASE_CODE < RHEL_RELEASE_VERSION(8,0)) || \
-     (RHEL_RELEASE_CODE >= RHEL_RELEASE_VERSION(8,1)))
 #define HAVE_PTP_SYS_OFFSET_EXTENDED_IOCTL
 #define HAVE_PTP_CLOCK_INFO_GETTIMEX64
-#else /* RHEL >= 7.7 && RHEL < 8.0 || RHEL >= 8.1 */
-struct ptp_system_timestamp {
-	struct timespec64 pre_ts;
-	struct timespec64 post_ts;
-};
-
-static inline void
-ptp_read_system_prets(struct ptp_system_timestamp __always_unused *sts)
-{
-	;
-}
-
-static inline void
-ptp_read_system_postts(struct ptp_system_timestamp __always_unused *sts)
-{
-	;
-}
-#endif /* !(RHEL >= 7.7 && RHEL != 8.0) */
 #if (RHEL_RELEASE_CODE && (RHEL_RELEASE_CODE >= RHEL_RELEASE_VERSION(8,1)))
 #define HAVE_NDO_BRIDGE_SETLINK_EXTACK
 #endif /* RHEL 8.1 */
diff --git a/src/kcompat_std_defs.h b/src/kcompat_std_defs.h
index 03fdb58..204128a 100644
--- a/src/kcompat_std_defs.h
+++ b/src/kcompat_std_defs.h
@@ -92,7 +92,6 @@
 
 /*****************************************************************************/
 #if (LINUX_VERSION_CODE < KERNEL_VERSION(5,4,0))
-#define NEED_SKB_FRAG_OFF_ACCESSORS
 #define NEED_FLOW_INDR_BLOCK_CB_REGISTER
 #else /* >= 5.4.0 */
 #endif /* 5.4.0 */
@@ -111,4 +110,12 @@
 #else /* >= 5.10.0 */
 #endif /* 5.10.0 */
 
+
+/*****************************************************************************/
+#if (LINUX_VERSION_CODE < KERNEL_VERSION(4,19,201))
+#define NEED_SKB_FRAG_OFF_ACCESSORS
+#else /* >= 4.19.201 */
+#undef NEED_SKB_FRAG_OFF_ACCESSORS
+#endif /* 4.19.201 */
+
 #endif /* _KCOMPAT_STD_DEFS_H_ */
