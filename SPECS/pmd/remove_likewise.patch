From b509d0f1c3923b7c4720c2754492439b5e1efad1 Mon Sep 17 00:00:00 2001
From: Tapas Kundu <tkundu@vmware.com>
Date: Thu, 27 Aug 2020 07:46:08 +0000
Subject: [PATCH] pmd: remove likewise-open dependency from pmd.

Change-Id: Ie9217af6b75285d2a7b8a7c06e6bbbc81641e97c
Signed-off-by: Tapas Kundu <tkundu@vmware.com>
---
 client/Makefile.am             |   8 +-
 client/includes.h              |   1 -
 client/rpc.c                   |   2 +-
 client/rpcmem.c                |   6 +-
 common/Makefile.am             |   4 +-
 common/defines.h               |  41 ++---
 common/includes.h              |   5 +-
 common/rpcsrvutils.c           |  10 +-
 common/strings.c               | 180 +++++++++++++++++--
 common/utils.c                 |   4 +-
 configure.ac                   |  41 +----
 idl/Makefile.am                |   4 +-
 idl/demo.idl                   |   1 -
 idl/demo_privsep.idl           |   1 -
 idl/fwmgmt.idl                 |   1 -
 idl/fwmgmt_privsep.idl         |   1 -
 idl/fwmgmtrpctypes.h           |   4 -
 idl/netmgmt.idl                |   1 -
 idl/netmgmt_privsep.idl        |   1 -
 idl/netmgmtrpctypes.h          |   4 -
 idl/pkgmgmt.idl                |   1 -
 idl/pkgmgmt_privsep.idl        |   1 -
 idl/pkgmgmtrpctypes.h          |   4 -
 idl/pmd.idl                    |   1 -
 idl/pmdrpctypes.h              |   4 -
 idl/rolemgmt.idl               |   1 -
 idl/rolemgmtrpctypes.h         |   4 -
 idl/rpmostree.idl              |   1 -
 idl/rpmostreerpctypes.h        |   4 -
 idl/usermgmt.idl               |   1 -
 idl/usermgmt_privsep.idl       |   1 -
 idl/usermgmtrpctypes.h         |   4 -
 include/pmderror.h             |  47 ++---
 pmd.spec.in                    |  25 +--
 privsep/Makefile.am            |   7 +-
 privsep/demo/Makefile.am       |   5 +-
 privsep/includes.h             |   3 -
 python/Makefile.am             |   3 +-
 rebuild.sh                     |   2 +-
 server/Makefile.am             |   5 +-
 server/common/Makefile.am      |   3 +-
 server/common/includes.h       |   1 -
 server/demo/Makefile.am        |   3 +-
 server/extras/Makefile.am      |   3 +-
 server/includes.h              |   3 -
 server/restutils/Makefile.am   |   5 +-
 server/restutils/includes.h    |   2 -
 server/restutils/prototypes.h  |   4 +-
 server/rolemgmt/Makefile.am    |   1 -
 server/rolemgmt/includes.h     |   2 -
 server/security/Makefile.am    |   3 +-
 server/security/apisecurity.c  | 306 ---------------------------------
 server/security/includes.h     |   3 -
 server/security/prototypes.h   |   8 -
 server/security/structs.h      |   2 -
 server/utils.c                 |   2 +-
 tools/cli/Makefile.am          |   3 +-
 tools/cli/demo/Makefile.am     |   2 +-
 tools/cli/fwmgmt/Makefile.am   |   3 +-
 tools/cli/netmgmt/Makefile.am  |   2 +-
 tools/cli/rolemgmt/Makefile.am |   3 +-
 tools/cli/usermgmt/Makefile.am |   3 +-
 tools/pmd.spec.in              | 285 ------------------------------
 63 files changed, 258 insertions(+), 838 deletions(-)
 delete mode 100644 tools/pmd.spec.in

diff --git a/client/Makefile.am b/client/Makefile.am
index a29ec47..16f66f5 100644
--- a/client/Makefile.am
+++ b/client/Makefile.am
@@ -2,8 +2,7 @@ lib_LTLIBRARIES = libpmdclient.la
 
 libpmdclient_la_CPPFLAGS = \
     -I$(top_srcdir)/include \
-    -I$(top_srcdir)/idl \
-    @LW_INCLUDES@
+    -I$(top_srcdir)/idl
 
 libpmdclient_la_SOURCES = \
     gssapi_creds_plugin.c \
@@ -92,10 +91,7 @@ CLEANFILES = \
 libpmdclient_la_LIBADD =  \
     @top_builddir@/common/libcommon.la \
     @DCERPC_LIBS@ \
-    @LWBASE_LIBS@ \
-    -lpthread \
-    -llwbase_nothr
+    -lpthread
 
 libpmdclient_la_LDFLAGS= \
-    @LW_LDFLAGS@ \
     @DCERPC_LDFLAGS@
diff --git a/client/includes.h b/client/includes.h
index 5f35c41..1ee7da0 100644
--- a/client/includes.h
+++ b/client/includes.h
@@ -13,7 +13,6 @@
  */
 #pragma once
 
-#include <lw/base.h>
 #include <ctype.h>
 #include <stdio.h>
 #include <stdlib.h>
diff --git a/client/rpc.c b/client/rpc.c
index 1d02c24..1a91f07 100644
--- a/client/rpc.c
+++ b/client/rpc.c
@@ -28,7 +28,7 @@ chk_dce_err(
 
     if (ecode != error_status_ok)
     {
-        dce_error_inq_text(ecode, (unsigned char *) errstr, &error_status);
+        dce_error_inq_text(ecode, (unsigned char *)errstr, &error_status);
         if (error_status == error_status_ok)
             printf("ERROR.  where = <%s> why = <%s> error code = 0x%x"
                    "reason = <%s>\n",
diff --git a/client/rpcmem.c b/client/rpcmem.c
index 355be0f..d43812d 100644
--- a/client/rpcmem.c
+++ b/client/rpcmem.c
@@ -474,9 +474,9 @@ PMDRpcFreeString(
     char** ppszString
 )
 {
-    uint32_t dwError = ERROR_SUCCESS;
+    uint32_t dwError = 0;
 
-    rpc_string_free((PBYTE*)ppszString, &dwError);
+    rpc_string_free((uint8_t **)ppszString, &dwError);
 
     return dwError;
 }
@@ -486,7 +486,7 @@ PMDRpcFreeBinding(
     handle_t* pBinding
 )
 {
-    uint32_t dwError = ERROR_SUCCESS;
+    uint32_t dwError = 0;
 
     rpc_binding_free(pBinding, &dwError);
 
diff --git a/common/Makefile.am b/common/Makefile.am
index ac33146..92cb2d9 100644
--- a/common/Makefile.am
+++ b/common/Makefile.am
@@ -14,12 +14,10 @@ libcommon_la_SOURCES = \
     utils.c
 
 libcommon_la_CPPFLAGS = \
-    -I$(top_srcdir)/include \
-    @LW_INCLUDES@
+    -I$(top_srcdir)/include
 
 libcommon_la_LDFLAGS = \
     @DCERPC_LIBS@ \
     @LIBCURL_LIBS@ \
     -lpthread \
-    -llwbase_nothr \
     -static
diff --git a/common/defines.h b/common/defines.h
index ff01acb..7bf0cf8 100644
--- a/common/defines.h
+++ b/common/defines.h
@@ -21,9 +21,8 @@ typedef unsigned short* wstring_t;
 #define MAX_LINE_LENGTH 1024
 #define MAX_CONFIG_LINE_LENGTH 1024
 #define INVALID_CMD_CHARS ";&|`"
-
 #define IsNullOrEmptyString(str) (!(str) || !(*str))
-
+typedef unsigned short int  wchar16_t;
 #define DO_RPC(rpc_pfn, sts) \
   do {                       \
     dcethread_exc *exc = NULL;      \
@@ -73,22 +72,24 @@ typedef unsigned short* wstring_t;
 #define PMD_UNKNOWN_ERROR_STRING "Unknown error"
 #define PMD_ERROR_TABLE \
 { \
-    {ERROR_PMD_BASE,                "ERROR_PMD_EBASE",               "Generic base error"}, \
-    {ERROR_PMD_CONF_FILE_LOAD,      "ERROR_PMD_CONF_FILE_LOAD",      "Error reading config file."}, \
-    {ERROR_PMD_INVALID_DAEMON_USER, "ERROR_PMD_INVALID_DAEMON_USER", "Could not verify server integrity for this communication. Cannot proceed."}, \
-    {ERROR_PMD_RPC_PEER_NOT_READY,  "ERROR_PMD_RPC_PEER_NOT_READY",  "rpc connection not established."}, \
-    {ERROR_PMD_PRIVSEP_INTEGRITY,   "ERROR_PMD_PRIVSEP_INTEGRITY",   "Unable to verify privilege separation integrity. Cannot proceed."}, \
-    {ERROR_PMD_MISSING_PRIVSEP_PUBKEY,"ERROR_PMD_MISSING_PRIVSEP_PUBKEY","Missing public key for privilege separation encryption. Please check config."}, \
-    {ERROR_PMD_PRIVSEP_ENCRYPT,     "ERROR_PMD_PRIVSEP_ENCRYPT",     "There was an error encrypting information for privilege separation. Please check privilege separation keys."}, \
-    {ERROR_PMD_PRIVSEP_DECRYPT,     "ERROR_PMD_PRIVSEP_DECRYPT",     "There was an error decrypting information for privilege separation. Please check privilege separation keys."}, \
-    {ERROR_PMD_INVALID_CMD,         "ERROR_PMD_INVALID_CMD",         "Invalid command."}, \
-    {ERROR_PMD_NOTHING_TO_DO,       "ERROR_PMD_NOTHING_TO_DO",       "Nothing to do."}, \
-    {ERROR_PMD_ROLES_PLUGIN_NOT_SET,"ERROR_PMD_ROLES_PLUGIN_NOT_SET","Plugin is not set for this role."}, \
-    {ERROR_PMD_ROLE_UNMAPPED_FN,    "ERROR_PMD_ROLE_UNMAPPED_FN",    "Plugin is loaded but does not specify an entry point for this functionality."}, \
-    {ERROR_PMD_ROLE_UNMAPPED_LOAD,  "ERROR_PMD_ROLE_UNMAPPED_LOAD",  "Plugin is loaded but does not specify an entry point for javelin_role_load."}, \
-    {ERROR_PMD_ROLE_PLUGIN_BAD,     "ERROR_PMD_ROLE_PLUGIN_BAD",     "Plugin is loaded but did not behave as expected. Plugin has been disabled for this session."}, \
-    {ERROR_PMD_ROLE_PLUGIN_DISABLED,"ERROR_PMD_ROLE_PLUGIN_DISABLED","Plugin is disabled. Most likely cause is an unexpected response from plugin apis. Restarting the server will reload plugins."}, \
-    {ERROR_PMD_ROLE_PLUGIN_HAS_TASKS,"ERROR_PMD_ROLE_PLUGIN_HAS_TASKS","Plugin has tasks. Please use status to get a status on tasks. Cannot queue another task at this time."}, \
-    {ERROR_PMD_ROLE_TASK_NOT_FOUND,  "ERROR_PMD_ROLE_TASK_NOT_FOUND",  "Could not find a task matching the id provided."}, \
-    {ERROR_PMD_ROLE_TASK_NO_LOGS,    "ERROR_PMD_ROLE_TASK_NO_LOGS",    "Task has no logs."}, \
+    {ERROR_PMD_BASE,                  "ERROR_PMD_EBASE",                  "Generic base error"}, \
+    {ERROR_PMD_CONF_FILE_LOAD,        "ERROR_PMD_CONF_FILE_LOAD",         "Error reading config file."}, \
+    {ERROR_PMD_INVALID_DAEMON_USER,   "ERROR_PMD_INVALID_DAEMON_USER",    "Could not verify server integrity for this communication. Cannot proceed."}, \
+    {ERROR_PMD_RPC_PEER_NOT_READY,    "ERROR_PMD_RPC_PEER_NOT_READY",     "rpc connection not established."}, \
+    {ERROR_PMD_PRIVSEP_INTEGRITY,     "ERROR_PMD_PRIVSEP_INTEGRITY",      "Unable to verify privilege separation integrity. Cannot proceed."}, \
+    {ERROR_PMD_MISSING_PRIVSEP_PUBKEY,"ERROR_PMD_MISSING_PRIVSEP_PUBKEY", "Missing public key for privilege separation encryption. Please check config."}, \
+    {ERROR_PMD_PRIVSEP_ENCRYPT,       "ERROR_PMD_PRIVSEP_ENCRYPT",        "There was an error encrypting information for privilege separation. Please check privilege separation keys."}, \
+    {ERROR_PMD_PRIVSEP_DECRYPT,       "ERROR_PMD_PRIVSEP_DECRYPT",        "There was an error decrypting information for privilege separation. Please check privilege separation keys."}, \
+    {ERROR_PMD_INVALID_CMD,           "ERROR_PMD_INVALID_CMD",            "Invalid command."}, \
+    {ERROR_PMD_NOTHING_TO_DO,         "ERROR_PMD_NOTHING_TO_DO",          "Nothing to do."}, \
+    {ERROR_PMD_ROLES_PLUGIN_NOT_SET,  "ERROR_PMD_ROLES_PLUGIN_NOT_SET",   "Plugin is not set for this role."}, \
+    {ERROR_PMD_ROLE_UNMAPPED_FN,      "ERROR_PMD_ROLE_UNMAPPED_FN",       "Plugin is loaded but does not specify an entry point for this functionality."}, \
+    {ERROR_PMD_ROLE_UNMAPPED_LOAD,    "ERROR_PMD_ROLE_UNMAPPED_LOAD",     "Plugin is loaded but does not specify an entry point for javelin_role_load."}, \
+    {ERROR_PMD_ROLE_PLUGIN_BAD,       "ERROR_PMD_ROLE_PLUGIN_BAD",        "Plugin is loaded but did not behave as expected. Plugin has been disabled for this session."}, \
+    {ERROR_PMD_ROLE_PLUGIN_DISABLED,  "ERROR_PMD_ROLE_PLUGIN_DISABLED",   "Plugin is disabled. Most likely cause is an unexpected response from plugin apis. Restarting the server will reload plugins."}, \
+    {ERROR_PMD_ROLE_PLUGIN_HAS_TASKS, "ERROR_PMD_ROLE_PLUGIN_HAS_TASKS",  "Plugin has tasks. Please use status to get a status on tasks. Cannot queue another task at this time."}, \
+    {ERROR_PMD_ROLE_TASK_NOT_FOUND,   "ERROR_PMD_ROLE_TASK_NOT_FOUND",    "Could not find a task matching the id provided."}, \
+    {ERROR_PMD_ROLE_TASK_NO_LOGS,     "ERROR_PMD_ROLE_TASK_NO_LOGS",      "Task has no logs."}, \
+    {ERROR_PMD_STRING_COMPARE_FAILED, "ERROR_PMD_STRING_COMPARE_FAILED",  "String comparison failed."}, \
+    {ERROR_PMD_CONVERT_TO_WCHAR_FAILED, "ERROR_PMD_CONVERT_TO_WCHAR_FAILED", "String conversion Failed."}, \
 };
diff --git a/common/includes.h b/common/includes.h
index a189b9b..69faf88 100644
--- a/common/includes.h
+++ b/common/includes.h
@@ -15,7 +15,7 @@
 
 #pragma once
 
-#include <lw/base.h>
+#include <errno.h>
 #include <ctype.h>
 #include <stdio.h>
 #include <stdlib.h>
@@ -23,13 +23,14 @@
 #include <stdint.h>
 #include <termios.h>
 #include <sys/wait.h>
+#include <locale.h>
+#include <iconv.h>
 
 #include <openssl/evp.h>
 #include <openssl/bio.h>
 #include <openssl/buffer.h>
 
 #include <pmderror.h>
- 
 #include <dce/rpc.h>
 #include <dce/dcethread.h>
 #include <dce/dce_error.h>
diff --git a/common/rpcsrvutils.c b/common/rpcsrvutils.c
index 20e711b..df2e0be 100644
--- a/common/rpcsrvutils.c
+++ b/common/rpcsrvutils.c
@@ -63,7 +63,7 @@ PMDRpcServerAllocateStringA(
     )
 {
     uint32_t dwError = 0;
-    PSTR pszTarget = NULL;
+    char *pszTarget = NULL;
     size_t length = 0;
 
     if (!pszSource)
@@ -107,7 +107,7 @@ PMDRpcServerAllocateStringW(
 {
     uint32_t  dwError = 0;
     size_t len = 0;
-    PWSTR  pwszTarget = NULL;
+    wchar16_t *pwszTarget = NULL;
 
     if (!pwszSource || !ppwszTarget)
     {
@@ -119,11 +119,11 @@ PMDRpcServerAllocateStringW(
     BAIL_ON_PMD_ERROR(dwError);
 
     dwError = PMDRpcServerAllocateMemory(
-                    sizeof(WCHAR) * (len + 1),
-                    (PVOID*)&pwszTarget);
+                    sizeof(wchar16_t) * (len + 1),
+                    (void**)&pwszTarget);
     BAIL_ON_PMD_ERROR(dwError);
 
-    memcpy((PBYTE)pwszTarget, (PBYTE)pwszSource, sizeof(WCHAR) * len);
+    memcpy((uint8_t *)pwszTarget, (uint8_t *)pwszSource, sizeof(wchar16_t) * len);
 
     *ppwszTarget = pwszTarget;
 
diff --git a/common/strings.c b/common/strings.c
index f042607..fc77fbb 100644
--- a/common/strings.c
+++ b/common/strings.c
@@ -14,6 +14,157 @@
 
 #include "includes.h"
 
+size_t
+PMDWC16StringNumChars(
+        wchar16_t const *pszString
+    )
+{
+    size_t len = 0;
+
+    if (pszString)
+    {
+        for(; pszString[len] != 0; len++);
+    }
+    return len;
+}
+
+uint32_t
+PMDConvertStringToWC16(
+    wchar16_t **ppwszDest,
+    const char *pszSrc
+    )
+{
+    iconv_t cd = 0;
+    size_t nconv = 0, insize = 0, mbLen = 0, mbSize = 0;
+    char *inputString = NULL;
+    char *wcharString = NULL;
+    wchar16_t *pwszbuf = NULL;
+    uint32_t dwError = 0;
+
+    if (!ppwszDest || !pszSrc)
+    {
+        dwError = ERROR_PMD_INVALID_PARAMETER;
+        BAIL_ON_PMD_ERROR(dwError);
+    }
+
+    cd = iconv_open ("UCS-2LE", "");
+    if (cd == (iconv_t)-1)
+    {
+        dwError = ERROR_PMD_CONVERT_TO_WCHAR_FAILED;
+        BAIL_ON_PMD_ERROR(dwError);
+    }
+
+    mbLen = mbstowcs (NULL, pszSrc, 0);
+    if (mbLen == -1)
+    {
+        dwError = ERROR_PMD_INVALID_PARAMETER;
+        BAIL_ON_PMD_ERROR(dwError);
+    }
+    mbSize = (mbLen + 1) * sizeof (wchar16_t);
+    dwError = PMDAllocateMemory (mbSize, (void**)&pwszbuf);
+    BAIL_ON_PMD_ERROR(dwError);
+
+    inputString = (char *)pszSrc;
+    wcharString = (char *)pwszbuf;
+    insize = strlen (pszSrc) * sizeof (char);
+
+    nconv = iconv (cd, &inputString, &insize, &wcharString, &mbSize);
+    if (nconv == -1)
+    {
+        dwError = ERROR_PMD_CONVERT_TO_WCHAR_FAILED;
+        BAIL_ON_PMD_ERROR(dwError);
+    }
+    if (mbSize >= sizeof (wchar16_t))
+    {
+        *(wchar16_t *)wcharString = 0;
+    }
+    *ppwszDest = pwszbuf;
+cleanup:
+    if (cd && (cd != (iconv_t)-1))
+    {
+        iconv_close(cd);
+    }
+    return dwError;
+
+error:
+    if (pwszbuf)
+    {
+        free(pwszbuf);
+    }
+    if (ppwszDest)
+    {
+        *ppwszDest = 0;
+    }
+    goto cleanup;
+
+}
+
+uint32_t
+PMDConvertWC16ToString(
+    char **ppszDest,
+    const wchar16_t *pwszSrc
+    )
+{
+    iconv_t cd = 0;
+    size_t nconv = 0, avail = 0, insize = 0;
+    char *wcharString = NULL;
+    char *pszbuf = NULL;
+    char *outputString = NULL;
+    uint32_t dwError = 0;
+
+    if (!ppszDest || !pwszSrc)
+    {
+        dwError = ERROR_PMD_INVALID_PARAMETER;
+        BAIL_ON_PMD_ERROR(dwError);
+    }
+
+    cd = iconv_open ("", "UCS-2LE");
+    if (cd == (iconv_t)-1)
+    {
+        dwError = ERROR_PMD_CONVERT_TO_WCHAR_FAILED;
+        BAIL_ON_PMD_ERROR(dwError);
+    }
+
+    insize = PMDWC16StringNumChars(pwszSrc) * sizeof(wchar16_t);
+
+    dwError = PMDAllocateMemory((insize + 1) * sizeof(char), (void **)&pszbuf);
+    BAIL_ON_PMD_ERROR(dwError);
+
+    wcharString = (char *)pwszSrc;
+    outputString = (char *)pszbuf;
+    avail = insize + 1; /* Added one for terminating with NULL */
+
+    nconv = iconv (cd, &wcharString, &insize, &outputString, &avail);
+    if (nconv == -1)
+    {
+        dwError = ERROR_PMD_CONVERT_TO_WCHAR_FAILED;
+        BAIL_ON_PMD_ERROR(dwError);
+    }
+    if (avail >= sizeof(wchar16_t))
+    {
+        *outputString = 0;
+    }
+
+    *ppszDest = pszbuf;
+cleanup:
+    if (cd && (cd != (iconv_t)-1))
+    {
+        iconv_close(cd);
+    }
+    return dwError;
+
+error:
+    if (pszbuf)
+    {
+        free(pszbuf);
+    }
+    if (ppszDest)
+    {
+        *ppszDest = 0;
+    }
+    goto cleanup;
+}
+
 uint32_t
 PMDSafeAllocateString(
     const char *pszSrc,
@@ -34,7 +185,7 @@ PMDGetStringLengthW(
     size_t* pLength
     )
 {
-    ULONG dwError = 0;
+    uint32_t dwError = 0;
 
     if (!pwszStr || !pLength)
     {
@@ -42,7 +193,7 @@ PMDGetStringLengthW(
     }
     else
     {
-        *pLength = LwRtlWC16StringNumChars(pwszStr);
+        *pLength = PMDWC16StringNumChars(pwszStr);
     }
 
     return dwError;
@@ -59,14 +210,16 @@ PMDAllocateStringWFromA(
     if (!pszSrc || !ppwszDst)
     {
         dwError = ERROR_PMD_INVALID_PARAMETER;
+        BAIL_ON_PMD_ERROR(dwError);
     }
-    else
-    {
-        dwError = LwNtStatusToWin32Error(
-                        LwRtlWC16StringAllocateFromCString(ppwszDst, pszSrc));
-    }
+    dwError = PMDConvertStringToWC16(ppwszDst, pszSrc);
+    BAIL_ON_PMD_ERROR(dwError);
 
+cleanup:
     return dwError;
+
+error:
+    goto cleanup;
 }
 
 uint32_t
@@ -83,8 +236,7 @@ PMDAllocateStringAFromW(
     }
     else
     {
-        dwError = LwNtStatusToWin32Error(
-                        LwRtlCStringAllocateFromWC16String(ppszDst, pwszSrc));
+        dwError = PMDConvertWC16ToString(ppszDst, pwszSrc);
     }
 
     return dwError;
@@ -210,16 +362,6 @@ PMDAllocateStringPrintf(
     goto cleanup;
 }
 
-int32_t
-PMDStringCompareA(
-    const char* pszStr1,
-    const char* pszStr2,
-    uint32_t bIsCaseSensitive
-    )
-{
-    return LwRtlCStringCompare(pszStr1, pszStr2, bIsCaseSensitive);
-}
-
 uint32_t
 find_in_array(
     char **ppszArray,
diff --git a/common/utils.c b/common/utils.c
index 7718786..782f515 100644
--- a/common/utils.c
+++ b/common/utils.c
@@ -197,7 +197,7 @@ do_rtrim(
 
     if(IsNullOrEmptyString(pszString) || !ppszTrimmedString)
     {
-        dwError = ERROR_INVALID_PARAMETER;
+        dwError = ERROR_PMD_INVALID_PARAMETER;
         BAIL_ON_PMD_ERROR(dwError);
     }
 
@@ -247,7 +247,7 @@ count_matches(
        IsNullOrEmptyString(pszFind) ||
        !pnCount)
     {
-        dwError = ERROR_INVALID_PARAMETER;
+        dwError = ERROR_PMD_INVALID_PARAMETER;
         BAIL_ON_PMD_ERROR(dwError);
     }
 
diff --git a/configure.ac b/configure.ac
index d1ed61c..df8cf31 100644
--- a/configure.ac
+++ b/configure.ac
@@ -14,35 +14,18 @@ AC_PROG_LIBTOOL
 
 CPPFLAGS="$CPPFLAGS -D_REENTRANT -D_GNU_SOURCE -fPIC"
 
-AM_CPPFLAGS="$AM_CPPFLAGS -I${top_srcdir}/include" 
+AM_CPPFLAGS="$AM_CPPFLAGS -I${top_srcdir}/include"
 AM_CFLAGS="$AM_CFLAGS -Wall -Werror -Wno-unused-variable -fno-strict-aliasing"
 
 AC_SUBST(AM_CPPFLAGS)
 AC_SUBST(AM_CFLAGS)
 
-AC_ARG_WITH([likewise],
-    [AC_HELP_STRING([--with-likewise=<dir>], [use likewise binaries rooted at prefix <dir> ])],
-    [
-        LW_BASE_PATH="$withval"
-        LW_INCLUDES="-I$withval/include"
-        LW_LDFLAGS="-L$withval/lib64 -Wl,-rpath,$withval/lib64 -Wl,-rpath-link,$withval/lib64"
-    ],
-    [
-        LW_BASE_PATH="/opt/likewise/"
-        LW_INCLUDES="-I/opt/likewise/include"
-        LW_LDFLAGS="-L/opt/likewise/lib64 -Wl,-rpath,/opt/likewise/lib64 -Wl,-rpath-link,/opt/likewise/lib64"
-    ])
-
-AC_SUBST(LW_BASE_PATH)
-AC_SUBST(LW_INCLUDES)
-AC_SUBST(LW_LDFLAGS)
-
 saved_CPPFLAGS="$CPPFLAGS"
-CPPFLAGS="$CPPFLAGS $LW_INCLUDES"
+CPPFLAGS="$CPPFLAGS"
 
-DCERPC_PATH=$LW_BASE_PATH/bin
-DCERPC_INCLUDES=$LW_INCLUDES
-DCERPC_LDFLAGS=$LW_LDFLAGS
+DCERPC_PATH="/usr/bin"
+DCERPC_INCLUDES="-I/usr/include"
+DCERPC_LDFLAGS="-L/usr/lib"
 
 AC_SUBST(DCERPC_PATH)
 AC_SUBST(DCERPC_INCLUDES)
@@ -97,8 +80,8 @@ AC_CHECK_LIB(
 AC_SUBST(CREST_LIBS)
 
 saved_CPPFLAGS="$CPPFLAGS"
-CPPFLAGS="$CPPFLAGS $LW_INCLUDES"
-AC_CHECK_HEADERS(lw/base.h lw/types.h uuid/uuid.h lwrpcrt/lwrpcrt.h dce/rpc.h)
+CPPFLAGS="$CPPFLAGS"
+AC_CHECK_HEADERS(uuid/uuid.h dce/rpc.h)
 CPPFLAGS="$saved_CPPFLAGS"
 
 AC_ARG_ENABLE([python],
@@ -137,14 +120,6 @@ AC_ARG_ENABLE([demo],
     ])
 AM_CONDITIONAL(ENABLE_DEMO, [test "$WITH_DEMO" = 1])
 
-AC_CHECK_LIB(
-    [lwbase],
-    [LwRtlMemoryAllocate],
-    [LWBASE_LIBS="-llwbase -llwbase_nothr"],
-    [],
-    [$LW_LDFLAGS -llwbase_nothr])
-
-AC_SUBST(LWBASE_LIBS)
 
 #tdnf
 PKG_CHECK_MODULES([TDNF], [tdnf], [have_libtdnf=yes], [have_libtdnf=no])
@@ -195,7 +170,7 @@ AC_CONFIG_FILES([Makefile
                  tools/cli/netmgmt/Makefile
                  tools/cli/usermgmt/Makefile
                  tools/cli/rolemgmt/Makefile
-                 tools/pmd.spec
+                 pmd.spec
                 ])
 
 #pmd conf dir
diff --git a/idl/Makefile.am b/idl/Makefile.am
index 0fd0741..884067f 100644
--- a/idl/Makefile.am
+++ b/idl/Makefile.am
@@ -1,5 +1,5 @@
-DCETOP = $(LW_BASE_PATH)
-DCEIDL = $(LW_BASE_PATH)/bin/dceidl
+DCETOP = /usr
+DCEIDL = /usr/bin/dceidl
 IDL_INCLUDE_DIR = $(DCETOP)/include
 IDLFLAGS = -I$(IDL_INCLUDE_DIR) -keep c_source
 
diff --git a/idl/demo.idl b/idl/demo.idl
index c197236..44a8389 100644
--- a/idl/demo.idl
+++ b/idl/demo.idl
@@ -21,7 +21,6 @@
 
 interface demo
 {
-#include <lw/types.h>
 #include "pmdrpctypes.h"
 
     unsigned32
diff --git a/idl/demo_privsep.idl b/idl/demo_privsep.idl
index 7dc6f8d..8fffe55 100644
--- a/idl/demo_privsep.idl
+++ b/idl/demo_privsep.idl
@@ -21,7 +21,6 @@
 
 interface demo_privsep
 {
-#include <lw/types.h>
 #include "pmdrpctypes.h"
 
     unsigned32
diff --git a/idl/fwmgmt.idl b/idl/fwmgmt.idl
index eb40c29..1088225 100644
--- a/idl/fwmgmt.idl
+++ b/idl/fwmgmt.idl
@@ -21,7 +21,6 @@
 
 interface fwmgmt
 {
-#include <lw/types.h>
 #include "pmdrpctypes.h"
 #include "fwmgmtrpctypes.h"
 
diff --git a/idl/fwmgmt_privsep.idl b/idl/fwmgmt_privsep.idl
index 885b262..5b64b6d 100644
--- a/idl/fwmgmt_privsep.idl
+++ b/idl/fwmgmt_privsep.idl
@@ -21,7 +21,6 @@
 
 interface fwmgmt_privsep
 {
-#include <lw/types.h>
 #include "pmdrpctypes.h"
 #include "fwmgmtrpctypes.h"
 
diff --git a/idl/fwmgmtrpctypes.h b/idl/fwmgmtrpctypes.h
index d363f45..786f7c0 100644
--- a/idl/fwmgmtrpctypes.h
+++ b/idl/fwmgmtrpctypes.h
@@ -20,10 +20,6 @@
 extern "C" {
 #endif
 
-#if (!defined NO_LIKEWISE && !defined _WIN32)
-#include <lw/types.h>
-#endif
-
 #ifdef _DCE_IDL_
 
 cpp_quote("#include <fwmgmtrpctypes.h>")
diff --git a/idl/netmgmt.idl b/idl/netmgmt.idl
index 9ace0e3..bd16027 100644
--- a/idl/netmgmt.idl
+++ b/idl/netmgmt.idl
@@ -21,7 +21,6 @@
 
 interface netmgmt
 {
-#include <lw/types.h>
 #include "pmdrpctypes.h"
 #include "netmgmtrpctypes.h"
 
diff --git a/idl/netmgmt_privsep.idl b/idl/netmgmt_privsep.idl
index dc007aa..8353fdb 100644
--- a/idl/netmgmt_privsep.idl
+++ b/idl/netmgmt_privsep.idl
@@ -21,7 +21,6 @@
 
 interface netmgmt_privsep
 {
-#include <lw/types.h>
 #include "pmdrpctypes.h"
 #include "netmgmtrpctypes.h"
 
diff --git a/idl/netmgmtrpctypes.h b/idl/netmgmtrpctypes.h
index 14e457a..8fde7be 100644
--- a/idl/netmgmtrpctypes.h
+++ b/idl/netmgmtrpctypes.h
@@ -20,10 +20,6 @@
 extern "C" {
 #endif
 
-#if (!defined NO_LIKEWISE && !defined _WIN32)
-#include <lw/types.h>
-#endif
-
 #ifdef _DCE_IDL_
 
 cpp_quote("#include <netmgmtrpctypes.h>")
diff --git a/idl/pkgmgmt.idl b/idl/pkgmgmt.idl
index dfb8b4e..b1d142f 100644
--- a/idl/pkgmgmt.idl
+++ b/idl/pkgmgmt.idl
@@ -21,7 +21,6 @@
 
 interface pkg
 {
-#include <lw/types.h>
 #include "pmdrpctypes.h"
 #include "pkgmgmtrpctypes.h"
 
diff --git a/idl/pkgmgmt_privsep.idl b/idl/pkgmgmt_privsep.idl
index 327b5e1..08790ac 100644
--- a/idl/pkgmgmt_privsep.idl
+++ b/idl/pkgmgmt_privsep.idl
@@ -21,7 +21,6 @@
 
 interface pkg_privsep
 {
-#include <lw/types.h>
 #include "pmdrpctypes.h"
 #include "pkgmgmtrpctypes.h"
 
diff --git a/idl/pkgmgmtrpctypes.h b/idl/pkgmgmtrpctypes.h
index 50d81c7..1dd32c0 100644
--- a/idl/pkgmgmtrpctypes.h
+++ b/idl/pkgmgmtrpctypes.h
@@ -20,10 +20,6 @@
 extern "C" {
 #endif
 
-#if (!defined NO_LIKEWISE && !defined _WIN32)
-#include <lw/types.h>
-#endif
-
 #ifdef _DCE_IDL_
 
 cpp_quote("#include <pkgmgmtrpctypes.h>")
diff --git a/idl/pmd.idl b/idl/pmd.idl
index 9889cde..27d8a7d 100644
--- a/idl/pmd.idl
+++ b/idl/pmd.idl
@@ -21,7 +21,6 @@
 
 interface pmd
 {
-#include <lw/types.h>
 #include "pmdrpctypes.h"
 
     unsigned32
diff --git a/idl/pmdrpctypes.h b/idl/pmdrpctypes.h
index 20090e1..3836577 100644
--- a/idl/pmdrpctypes.h
+++ b/idl/pmdrpctypes.h
@@ -20,10 +20,6 @@
 extern "C" {
 #endif
 
-#if (!defined NO_LIKEWISE && !defined _WIN32)
-#include <lw/types.h>
-#endif
-
 #define PMD_NCALRPC_BASE              "/var/run/pmd"
 #define PMD_NCALRPC_SOCKET            "pmd_socket"
 #define PMD_NCALRPC_END_POINT         PMD_NCALRPC_BASE"/"PMD_NCALRPC_SOCKET
diff --git a/idl/rolemgmt.idl b/idl/rolemgmt.idl
index fc4e6e6..abeb628 100644
--- a/idl/rolemgmt.idl
+++ b/idl/rolemgmt.idl
@@ -20,7 +20,6 @@
 
 interface rolemgmt 
 {
-#include <lw/types.h>
 #include "pmdrpctypes.h"
 #include "rolemgmtrpctypes.h"
 
diff --git a/idl/rolemgmtrpctypes.h b/idl/rolemgmtrpctypes.h
index 80c37f3..d1134be 100644
--- a/idl/rolemgmtrpctypes.h
+++ b/idl/rolemgmtrpctypes.h
@@ -19,10 +19,6 @@
 extern "C" {
 #endif
 
-#if (!defined NO_LIKEWISE && !defined _WIN32)
-#include <lw/types.h>
-#endif
-
 #ifdef _DCE_IDL_
 
 cpp_quote("#include <rolemgmtrpctypes.h>")
diff --git a/idl/rpmostree.idl b/idl/rpmostree.idl
index 4ef6a73..685a9f8 100644
--- a/idl/rpmostree.idl
+++ b/idl/rpmostree.idl
@@ -21,7 +21,6 @@
 
 interface rpmostree
 {
-#include <lw/types.h>
 #include "pmdrpctypes.h"
 #include "rpmostreerpctypes.h"
 
diff --git a/idl/rpmostreerpctypes.h b/idl/rpmostreerpctypes.h
index caefa97..dabd755 100644
--- a/idl/rpmostreerpctypes.h
+++ b/idl/rpmostreerpctypes.h
@@ -20,10 +20,6 @@
 extern "C" {
 #endif
 
-#if (!defined NO_LIKEWISE && !defined _WIN32)
-#include <lw/types.h>
-#endif
-
 #ifdef _DCE_IDL_
 
 cpp_quote("#include <rpmostreerpctypes.h>")
diff --git a/idl/usermgmt.idl b/idl/usermgmt.idl
index 24348c6..40bb5a7 100644
--- a/idl/usermgmt.idl
+++ b/idl/usermgmt.idl
@@ -21,7 +21,6 @@
 
 interface usermgmt
 {
-#include <lw/types.h>
 #include "pmdrpctypes.h"
 #include "usermgmtrpctypes.h"
 
diff --git a/idl/usermgmt_privsep.idl b/idl/usermgmt_privsep.idl
index 03b26c2..7e232e4 100644
--- a/idl/usermgmt_privsep.idl
+++ b/idl/usermgmt_privsep.idl
@@ -21,7 +21,6 @@
 
 interface usermgmt_privsep
 {
-#include <lw/types.h>
 #include "pmdrpctypes.h"
 #include "usermgmtrpctypes.h"
 
diff --git a/idl/usermgmtrpctypes.h b/idl/usermgmtrpctypes.h
index 305e6b4..428de69 100644
--- a/idl/usermgmtrpctypes.h
+++ b/idl/usermgmtrpctypes.h
@@ -20,10 +20,6 @@
 extern "C" {
 #endif
 
-#if (!defined NO_LIKEWISE && !defined _WIN32)
-#include <lw/types.h>
-#endif
-
 #ifdef _DCE_IDL_
 
 cpp_quote("#include <usermgmtrpctypes.h>")
diff --git a/include/pmderror.h b/include/pmderror.h
index 95356d7..393ebd0 100644
--- a/include/pmderror.h
+++ b/include/pmderror.h
@@ -19,29 +19,30 @@ extern "C" {
 #endif
 
 //PMD specific errors(3000 to 3999)
-#define ERROR_PMD_BASE                  3000
-#define ERROR_PMD_FAIL                  (ERROR_PMD_BASE + 1)
-#define ERROR_PMD_NOTHING_TO_DO         (ERROR_PMD_BASE + 2)
-#define ERROR_PMD_CONF_FILE_LOAD        (ERROR_PMD_BASE + 3)
-#define ERROR_PMD_BASE64_ENCODE         (ERROR_PMD_BASE + 4)
-#define ERROR_PMD_BASE64_DECODE         (ERROR_PMD_BASE + 5)
-#define ERROR_PMD_USER_PASS_FORMAT      (ERROR_PMD_BASE + 6)
-#define ERROR_PMD_JSON_SET_VALUE        (ERROR_PMD_BASE + 7)
-#define ERROR_PMD_ROLES_DIR_OPEN        (ERROR_PMD_BASE + 21)
-#define ERROR_PMD_ROLES_NO_SUCH_ROLE    (ERROR_PMD_BASE + 22)
-#define ERROR_PMD_ROLES_PLUGIN_NOT_SET  (ERROR_PMD_BASE + 23)
-#define ERROR_PMD_ROLE_CONFIG_NO_PARENT (ERROR_PMD_BASE + 24)
-#define ERROR_PMD_ROLE_UNMAPPED_FN      (ERROR_PMD_BASE + 25)
-#define ERROR_PMD_ROLE_UNMAPPED_LOAD    (ERROR_PMD_BASE + 26)
-#define ERROR_PMD_ROLE_PLUGIN_BAD       (ERROR_PMD_BASE + 27)
-#define ERROR_PMD_ROLE_PLUGIN_DISABLED  (ERROR_PMD_BASE + 28)
-#define ERROR_PMD_ROLE_PLUGIN_HAS_TASKS (ERROR_PMD_BASE + 29)
-#define ERROR_PMD_ROLE_TASK_NOT_FOUND   (ERROR_PMD_BASE + 30)
-#define ERROR_PMD_ROLE_TASK_NO_LOGS     (ERROR_PMD_BASE + 31)
-#define ERROR_PMD_ROLE_PATH_MISMATCH    (ERROR_PMD_BASE + 32)
-#define ERROR_PMD_ROLE_BAD_STATUS       (ERROR_PMD_BASE + 33)
-#define ERROR_PMD_ROLE_BAD_OPERATION    (ERROR_PMD_BASE + 34)
-
+#define ERROR_PMD_BASE                        3000
+#define ERROR_PMD_FAIL                        (ERROR_PMD_BASE + 1)
+#define ERROR_PMD_NOTHING_TO_DO               (ERROR_PMD_BASE + 2)
+#define ERROR_PMD_CONF_FILE_LOAD              (ERROR_PMD_BASE + 3)
+#define ERROR_PMD_BASE64_ENCODE               (ERROR_PMD_BASE + 4)
+#define ERROR_PMD_BASE64_DECODE               (ERROR_PMD_BASE + 5)
+#define ERROR_PMD_USER_PASS_FORMAT            (ERROR_PMD_BASE + 6)
+#define ERROR_PMD_JSON_SET_VALUE              (ERROR_PMD_BASE + 7)
+#define ERROR_PMD_ROLES_DIR_OPEN              (ERROR_PMD_BASE + 21)
+#define ERROR_PMD_ROLES_NO_SUCH_ROLE          (ERROR_PMD_BASE + 22)
+#define ERROR_PMD_ROLES_PLUGIN_NOT_SET        (ERROR_PMD_BASE + 23)
+#define ERROR_PMD_ROLE_CONFIG_NO_PARENT       (ERROR_PMD_BASE + 24)
+#define ERROR_PMD_ROLE_UNMAPPED_FN            (ERROR_PMD_BASE + 25)
+#define ERROR_PMD_ROLE_UNMAPPED_LOAD          (ERROR_PMD_BASE + 26)
+#define ERROR_PMD_ROLE_PLUGIN_BAD             (ERROR_PMD_BASE + 27)
+#define ERROR_PMD_ROLE_PLUGIN_DISABLED        (ERROR_PMD_BASE + 28)
+#define ERROR_PMD_ROLE_PLUGIN_HAS_TASKS       (ERROR_PMD_BASE + 29)
+#define ERROR_PMD_ROLE_TASK_NOT_FOUND         (ERROR_PMD_BASE + 30)
+#define ERROR_PMD_ROLE_TASK_NO_LOGS           (ERROR_PMD_BASE + 31)
+#define ERROR_PMD_ROLE_PATH_MISMATCH          (ERROR_PMD_BASE + 32)
+#define ERROR_PMD_ROLE_BAD_STATUS             (ERROR_PMD_BASE + 33)
+#define ERROR_PMD_ROLE_BAD_OPERATION          (ERROR_PMD_BASE + 34)
+#define ERROR_PMD_STRING_COMPARE_FAILED       (ERROR_PMD_BASE + 35)
+#define ERROR_PMD_CONVERT_TO_WCHAR_FAILED     (ERROR_PMD_BASE + 36)
 //REST specific errors (3500 to 3600)
 #define ERROR_PMD_REST_BASE                3500
 #define ERROR_PMD_REST_AUTH_REQUIRED       (ERROR_PMD_REST_BASE + 1)
diff --git a/pmd.spec.in b/pmd.spec.in
index c620857..78b8471 100644
--- a/pmd.spec.in
+++ b/pmd.spec.in
@@ -5,11 +5,10 @@
 Summary:	Photon Management Daemon
 Name:		pmd
 Version:	@VERSION@
-Release:	6%{?dist}
+Release:	7%{?dist}
 License:	Apache 2.0
 URL:            https://www.github.com/vmware/pmd
 Group:		Applications/System
-Requires:	likewise-open >= 6.2.9
 Requires:       netmgmt
 Requires:	systemd
 Requires:	tdnf >= 1.2.0
@@ -24,7 +23,6 @@ BuildRequires:	c-rest-engine-devel
 BuildRequires:	netmgmt-devel
 BuildRequires:  jansson-devel
 BuildRequires:  copenapi-devel
-BuildRequires:	likewise-open-devel >= 6.2.9
 BuildRequires:	krb5-devel
 BuildRequires:	glib-devel
 BuildRequires:	curl-devel
@@ -35,7 +33,6 @@ Photon Management Daemon
 
 %package libs
 Summary: photon management daemon libs
-Requires: likewise-open >= 6.2.0
 
 %description libs
 photon management daemon libs used by server and clients
@@ -44,7 +41,6 @@ photon management daemon libs used by server and clients
 BuildRequires:	netmgmt-cli-devel >= 1.0.4-2
 Summary: photon management daemon cmd line cli
 Requires: %{name}-libs = %{version}-%{release}
-Requires: likewise-open >= 6.2.0
 
 %description cli
 photon management daemon cmd line cli
@@ -57,15 +53,6 @@ Requires: %{name} = %{version}-%{release}
 %description devel
 photon management daemon client devel
 
-%package python2
-Summary: Python2 bindings for photon management daemon
-Group: Development/Libraries
-Requires: python2 >= 2.7
-Requires: %{name}-cli = %{version}-%{release}
-BuildRequires: python2-devel >= 2.7
-
-%description python2
-Python2 bindings for photon management daemon
 
 %package python3
 Summary: Python3 bindings for photon management daemon
@@ -88,14 +75,12 @@ autoreconf -mif
     --bindir=%{_bindir} \
     --libdir=%{_libdir} \
     --sysconfdir=/etc \
-    --with-likewise=/opt/likewise \
     --enable-python=no \
     --enable-demo=yes \
     --disable-static
 make
 
 pushd python
-python2 setup.py build
 python3 setup.py build
 popd
 
@@ -105,8 +90,6 @@ make DESTDIR=%{buildroot} install
 rm -f %{buildroot}%{_libdir}/*.la
 
 pushd python
-python2 setup.py install --skip-build --root %{buildroot}
-rm -f %{buildroot}%{python_sitearch}/pmd.so
 python3 setup.py install --skip-build --root %{buildroot}
 popd
 
@@ -290,15 +273,13 @@ rm -rf %{buildroot}/*
     %{_includedir}/pmd/*.h
     %{_libdir}/pkgconfig/pmdclient.pc
 
-%files python2
-    %{python_sitearch}/%{name}/
-    %{python_sitearch}/%{name}_python-*.egg-info
-
 %files python3
     %{_python3_sitearch}/%{name}/
     %{_python3_sitearch}/%{name}_python-*.egg-info
 
 %changelog
+*       Tue Oct 20 2020 Tapas Kundu <tkundu@vmware.com> 0.1-7
+-       Remove likewise dependency
 *       Fri Oct 16 2020 Shreyas B <shreyasb@vmware.com> 0.1-6
 -       Remove PMD Dependencies on LightWave.
 *       Fri Aug 21 2020 Tapas Kundu <tkundu@vmware.com> 0.1-5
diff --git a/privsep/Makefile.am b/privsep/Makefile.am
index 87a7876..3346001 100644
--- a/privsep/Makefile.am
+++ b/privsep/Makefile.am
@@ -2,8 +2,7 @@ bin_PROGRAMS = pmdprivsepd
 
 pmdprivsepd_CPPFLAGS = \
     -I$(top_srcdir)/include \
-    -I$(top_srcdir)/idl \
-    @LW_INCLUDES@
+    -I$(top_srcdir)/idl
 
 pmdprivsepd_SOURCES = \
     global.c \
@@ -54,7 +53,6 @@ pmdprivsepd_LDADD =  \
     @top_builddir@/server/common/libsrvcommon.la \
     @top_builddir@/privsep/demo/libdemosrv.la \
     @DCERPC_LIBS@ \
-    @LWBASE_LIBS@ \
     -ltdnf \
     -lnetmgr \
     -lpthread \
@@ -63,5 +61,4 @@ pmdprivsepd_LDADD =  \
     -ldl
 
 pmdprivsepd_LDFLAGS = \
-    @DCERPC_LDFLAGS@ \
-    @LW_LDFLAGS@
+    @DCERPC_LDFLAGS@
diff --git a/privsep/demo/Makefile.am b/privsep/demo/Makefile.am
index f9681e9..e2b6f98 100644
--- a/privsep/demo/Makefile.am
+++ b/privsep/demo/Makefile.am
@@ -2,9 +2,8 @@ noinst_LTLIBRARIES = libdemosrv.la
 
 libdemosrv_la_CPPFLAGS = \
     -I$(top_srcdir)/include \
-    -I$(top_srcdir)/idl \
-    @LW_INCLUDES@
-    
+    -I$(top_srcdir)/idl
+ 
 libdemosrv_la_SOURCES = \
     demo_privsep_sstub.c \
     demoapi.c \
diff --git a/privsep/includes.h b/privsep/includes.h
index 6ceaed6..58125a7 100644
--- a/privsep/includes.h
+++ b/privsep/includes.h
@@ -15,9 +15,6 @@
 
 #pragma once
 
-#include <lw/base.h>
-#include <lw/types.h>
-
 #include <ctype.h>
 #include <locale.h>
 #include <stdio.h>
diff --git a/python/Makefile.am b/python/Makefile.am
index 4fa407a..34ea9c2 100644
--- a/python/Makefile.am
+++ b/python/Makefile.am
@@ -5,8 +5,7 @@ CLEANFILES =
 
 _pmd_la_CPPFLAGS = \
     -I$(top_srcdir)/include \
-    -I@WITH_PYTHON_INCLUDE@ \
-    @LW_INCLUDES@
+    -I@WITH_PYTHON_INCLUDE@
 
 _pmd_la_SOURCES = \
     fwmgmt_py.c \
diff --git a/rebuild.sh b/rebuild.sh
index d9b42de..aaf5f3b 100755
--- a/rebuild.sh
+++ b/rebuild.sh
@@ -1,4 +1,4 @@
 #!/bin/sh
 make clean && make distclean
-aclocal && libtoolize && automake --add-missing && autoreconf && ./configure --with-likewise=/opt/likewise --enable-python=yes --enable-demo=yes
+aclocal && libtoolize && automake --add-missing && autoreconf && ./configure --enable-python=yes --enable-demo=yes
 make
diff --git a/server/Makefile.am b/server/Makefile.am
index 784d88a..13f51a3 100644
--- a/server/Makefile.am
+++ b/server/Makefile.am
@@ -5,7 +5,6 @@ AM_CFLAGS += $(COPENAPI_CFLAGS)
 pmd_CPPFLAGS = \
     -I$(top_srcdir)/include \
     -I$(top_srcdir)/idl \
-    @LW_INCLUDES@ \
     @CREST_INCLUDES@
 
 pmd_SOURCES = \
@@ -87,7 +86,6 @@ pmd_LDADD =  \
     @JANSSON_LIBS@ \
     @CREST_LIBS@ \
     @COPENAPI_LIBS@ \
-    @LWBASE_LIBS@ \
     -lnetmgr \
     -lpthread \
     -lcrypt \
@@ -96,8 +94,7 @@ pmd_LDADD =  \
 
 pmd_LDFLAGS = \
     @CREST_LDFLAGS@ \
-    @DCERPC_LDFLAGS@ \
-    @LW_LDFLAGS@
+    @DCERPC_LDFLAGS@
 
 if ENABLE_DEMO
     pmd_LDADD += @top_builddir@/server/demo/libdemosrv.la
diff --git a/server/common/Makefile.am b/server/common/Makefile.am
index d49e1d2..dd87057 100644
--- a/server/common/Makefile.am
+++ b/server/common/Makefile.am
@@ -5,8 +5,7 @@ libsrvcommon_la_SOURCES = \
     signal.c
 
 libsrvcommon_la_CPPFLAGS = \
-    -I$(top_srcdir)/include \
-    @LW_INCLUDES@
+    -I$(top_srcdir)/include
 
 libsrvcommon_la_LDFLAGS = \
     -static
diff --git a/server/common/includes.h b/server/common/includes.h
index 058b9d8..f2ed5d1 100644
--- a/server/common/includes.h
+++ b/server/common/includes.h
@@ -15,7 +15,6 @@
 
 #pragma once
 
-#include <lw/base.h>
 #include <ctype.h>
 #include <stdio.h>
 #include <stdlib.h>
diff --git a/server/demo/Makefile.am b/server/demo/Makefile.am
index a28ce7e..a4e7574 100644
--- a/server/demo/Makefile.am
+++ b/server/demo/Makefile.am
@@ -4,8 +4,7 @@ AM_CFLAGS += $(JANSSON_CFLAGS)
 
 libdemosrv_la_CPPFLAGS = \
     -I$(top_srcdir)/include \
-    -I$(top_srcdir)/idl \
-    @LW_INCLUDES@
+    -I$(top_srcdir)/idl
 
 libdemosrv_la_SOURCES = \
     demoapi.c \
diff --git a/server/extras/Makefile.am b/server/extras/Makefile.am
index fd3b447..d696194 100644
--- a/server/extras/Makefile.am
+++ b/server/extras/Makefile.am
@@ -2,8 +2,7 @@ noinst_LTLIBRARIES = libpmdextras.la
 
 libpmdextras_la_CPPFLAGS = \
     -I$(top_srcdir)/include \
-    -I$(top_srcdir)/idl \
-    @LW_INCLUDES@
+    -I$(top_srcdir)/idl
 
 libpmdextras_la_SOURCES =
 
diff --git a/server/includes.h b/server/includes.h
index 9964d48..0f34976 100644
--- a/server/includes.h
+++ b/server/includes.h
@@ -14,9 +14,6 @@
 
 #pragma once
 
-#include <lw/base.h>
-#include <lw/types.h>
-
 #include <ctype.h>
 #include <locale.h>
 #include <stdio.h>
diff --git a/server/restutils/Makefile.am b/server/restutils/Makefile.am
index 93730ad..9c2f721 100644
--- a/server/restutils/Makefile.am
+++ b/server/restutils/Makefile.am
@@ -4,9 +4,8 @@ AM_CFLAGS += $(JANSSON_CFLAGS)
 AM_CFLAGS += $(COPENAPI_CFLAGS)
 
 librestutils_la_CPPFLAGS = \
-    -I$(top_srcdir)/include \
-    @LW_INCLUDES@
-    
+    -I$(top_srcdir)/include
+ 
 librestutils_la_SOURCES = \
     global.c \
     restauth.c \
diff --git a/server/restutils/includes.h b/server/restutils/includes.h
index 6f8a467..d7e0ec6 100644
--- a/server/restutils/includes.h
+++ b/server/restutils/includes.h
@@ -14,8 +14,6 @@
 
 
 #pragma once
-#include <lw/base.h>
-#include <lw/types.h>
 
 #include <stdio.h>
 #include <string.h>
diff --git a/server/restutils/prototypes.h b/server/restutils/prototypes.h
index 1805d39..52de57b 100644
--- a/server/restutils/prototypes.h
+++ b/server/restutils/prototypes.h
@@ -12,8 +12,8 @@
  * under the License.
  */
 
-
 #pragma once
+#include "includes.h"
 //openidconnect.c
 uint32_t
 process_oidc_auth_header(
@@ -262,7 +262,7 @@ request_negotiate_auth(
 uint32_t
 make_negotiate_string(
     gss_buffer_desc *pBuffer,
-    PSTR *ppszNegotiate
+    char **ppszNegotiate
     );
 
 uint32_t
diff --git a/server/rolemgmt/Makefile.am b/server/rolemgmt/Makefile.am
index b2ff41f..c8a9531 100644
--- a/server/rolemgmt/Makefile.am
+++ b/server/rolemgmt/Makefile.am
@@ -3,7 +3,6 @@ noinst_LTLIBRARIES = librolemgmt.la
 librolemgmt_la_CPPFLAGS = \
     -I$(top_srcdir)/include \
     -I$(top_srcdir)/idl \
-    @LW_INCLUDES@ \
     @UUID_CFLAGS@
     
 librolemgmt_la_SOURCES = \
diff --git a/server/rolemgmt/includes.h b/server/rolemgmt/includes.h
index 145cef8..91536d1 100644
--- a/server/rolemgmt/includes.h
+++ b/server/rolemgmt/includes.h
@@ -13,8 +13,6 @@
  */
 
 #pragma once
-#include <lw/base.h>
-#include <lw/types.h>
 
 #include <stdio.h>
 #include <string.h>
diff --git a/server/security/Makefile.am b/server/security/Makefile.am
index cf00428..695caa8 100644
--- a/server/security/Makefile.am
+++ b/server/security/Makefile.am
@@ -1,8 +1,7 @@
 noinst_LTLIBRARIES = libpmdsecurity.la
 
 libpmdsecurity_la_CPPFLAGS = \
-    -I$(top_srcdir)/include \
-    @LW_INCLUDES@
+    -I$(top_srcdir)/include
 
 libpmdsecurity_la_SOURCES = \
     apisecurity.c \
diff --git a/server/security/apisecurity.c b/server/security/apisecurity.c
index e3dda37..2d6af18 100644
--- a/server/security/apisecurity.c
+++ b/server/security/apisecurity.c
@@ -145,238 +145,6 @@ init_module_security(
     goto cleanup;
 }
 
-
-uint32_t
-init_security_context(
-    PPMD_SECURITY_CONTEXT pContext
-    )
-{
-    uint32_t dwError = 0;
-    PLW_MAP_SECURITY_CONTEXT pSecContext = NULL;
-
-    if(!pContext)
-    {
-        dwError = ERROR_PMD_INVALID_PARAMETER;
-        BAIL_ON_PMD_ERROR(dwError);
-    }
-
-    if(pContext->pSecContext)
-    {
-        dwError = EALREADY;
-        BAIL_ON_PMD_ERROR(dwError);
-    }
-
-    dwError = LwMapSecurityInitialize();
-    BAIL_ON_PMD_ERROR(dwError);
-
-    dwError = LwMapSecurityCreateContext(&pSecContext);
-    BAIL_ON_PMD_ERROR(dwError);
-
-
-    pContext->pSecContext = pSecContext;
-
-cleanup:
-    return dwError;
-
-error:
-    if(dwError == EALREADY)
-    {
-        dwError = 0;
-    }
-    if(pSecContext)
-    {
-        LwMapSecurityFreeContext(&pSecContext);
-    }
-    goto cleanup;
-}
-
-uint32_t
-absolute_from_relative_sd(
-    PSECURITY_DESCRIPTOR_RELATIVE pRelative,
-    PSECURITY_DESCRIPTOR_ABSOLUTE *ppAbsolute
-    )
-{
-    uint32_t dwError = 0;
-    PSECURITY_DESCRIPTOR_ABSOLUTE pAbsolute = NULL;
-    PSID pOwnerSid = NULL;
-    PSID pGroupSid = NULL;
-    PACL pDacl = NULL;
-    PACL pSacl = NULL;
-    uint32_t nAbsSize = 0;
-    uint32_t nOwnerSize = 0;
-    uint32_t nGroupSize = 0;
-    uint32_t nDaclSize = 0;
-    uint32_t nSaclSize = 0;
-
-    dwError = RtlSelfRelativeToAbsoluteSD(
-                 pRelative,
-                 pAbsolute,
-                 &nAbsSize,
-                 pDacl,
-                 &nDaclSize,
-                 pSacl,
-                 &nSaclSize,
-                 pOwnerSid,
-                 &nOwnerSize,
-                 pGroupSid,
-                 &nGroupSize);
-    if (dwError != STATUS_BUFFER_TOO_SMALL)
-    {
-        BAIL_ON_PMD_ERROR(dwError);
-    }
-    dwError = PMDAllocateMemory(
-                  SECURITY_DESCRIPTOR_ABSOLUTE_MIN_SIZE,
-                  (void **)&pAbsolute);
-    BAIL_ON_PMD_ERROR(dwError);
-
-    dwError = RtlCreateSecurityDescriptorAbsolute(
-                  pAbsolute,
-                  SECURITY_DESCRIPTOR_REVISION);
-    BAIL_ON_PMD_ERROR(dwError);
-
-    if (nDaclSize)
-    {
-        dwError = PMDAllocateMemory(nDaclSize, (void **)&pDacl);
-        BAIL_ON_PMD_ERROR(dwError);
-    }
-
-    if (nSaclSize)
-    {
-        dwError = PMDAllocateMemory(nSaclSize, (void **)&pSacl);
-        BAIL_ON_PMD_ERROR(dwError);
-    }
-
-    if (nOwnerSize)
-    {
-        dwError = PMDAllocateMemory(nOwnerSize, (void **)&pOwnerSid);
-        BAIL_ON_PMD_ERROR(dwError);
-    }
-
-    if (nGroupSize)
-    {
-        dwError = PMDAllocateMemory(nGroupSize, (void **)&pGroupSid);
-        BAIL_ON_PMD_ERROR(dwError);
-    }
-
-    dwError = RtlSelfRelativeToAbsoluteSD(
-                 pRelative,
-                 pAbsolute,
-                 &nAbsSize,
-                 pDacl,
-                 &nDaclSize,
-                 pSacl,
-                 &nSaclSize,
-                 pOwnerSid,
-                 &nOwnerSize,
-                 pGroupSid,
-                 &nGroupSize);
-    BAIL_ON_PMD_ERROR(dwError);
-
-    *ppAbsolute = pAbsolute;
-
-cleanup:
-    return dwError;
-
-error:
-    PMD_SAFE_FREE_MEMORY(pOwnerSid);
-    PMD_SAFE_FREE_MEMORY(pGroupSid);
-    PMD_SAFE_FREE_MEMORY(pDacl);
-    PMD_SAFE_FREE_MEMORY(pSacl);
-    PMD_SAFE_FREE_MEMORY(pAbsolute);
-
-    goto cleanup;
-}
-
-uint32_t
-sddl_to_sec_abs(
-    const char *pszSDDL,
-    PSECURITY_DESCRIPTOR_ABSOLUTE *ppSecAbs
-    )
-{
-    uint32_t dwError = 0;
-    NTSTATUS ntStatus = STATUS_SUCCESS;
-    uint32_t dwSize = 0;
-    PSECURITY_DESCRIPTOR_ABSOLUTE pSecAbs = NULL;
-    PSECURITY_DESCRIPTOR_RELATIVE pSecRel = NULL;
-
-    if(IsNullOrEmptyString(pszSDDL) || !ppSecAbs)
-    {
-        ntStatus = STATUS_INVALID_PARAMETER;
-        BAIL_ON_NT_STATUS(ntStatus);
-    }
-
-    ntStatus = RtlAllocateSecurityDescriptorFromSddlCString(
-                        &pSecRel,
-                        &dwSize,
-                        pszSDDL,
-                        SDDL_REVISION_1);
-    if (ntStatus == STATUS_BUFFER_TOO_SMALL)
-    {
-        ntStatus = STATUS_SUCCESS;
-    }
-    BAIL_ON_NT_STATUS(ntStatus);
-
-    dwError = PMDAllocateMemory(dwSize, (void **)&pSecAbs);
-    BAIL_ON_PMD_ERROR(dwError);
-
-    ntStatus = RtlAllocateSecurityDescriptorFromSddlCString(
-                        &pSecRel,
-                        &dwSize,
-                        pszSDDL,
-                        SDDL_REVISION_1);
-    BAIL_ON_NT_STATUS(ntStatus);
-
-    ntStatus = absolute_from_relative_sd(pSecRel, &pSecAbs);
-    BAIL_ON_NT_STATUS(ntStatus);
-
-    *ppSecAbs = pSecAbs;
-
-cleanup:
-    return dwError;
-
-error:
-    if(ppSecAbs)
-    {
-        *ppSecAbs = NULL;
-    }
-    PMD_SAFE_FREE_MEMORY(pSecAbs);
-    goto cleanup;
-}
-
-uint32_t
-init_security_abs(
-    PPMD_SECURITY_CONTEXT pContext,
-    PPMD_API_SECURITY pApiSecurity
-    )
-{
-    uint32_t dwError = 0;
-
-    if(!pContext || !pApiSecurity)
-    {
-        dwError = ERROR_PMD_INVALID_PARAMETER;
-        BAIL_ON_PMD_ERROR(dwError);
-    }
-
-    if(!pContext->pSecContext)
-    {
-        dwError = init_security_context(pContext);
-        BAIL_ON_PMD_ERROR(dwError);
-    }
-
-    if(!pApiSecurity->pSecAbs)
-    {
-        dwError = sddl_to_sec_abs(pApiSecurity->pszSDDL,
-                                  &pApiSecurity->pSecAbs);
-        BAIL_ON_PMD_ERROR(dwError);
-    }
-
-cleanup:
-    return dwError;
-
-error:
-    goto cleanup;
-}
-
 uint32_t
 find_module_api(
     PPMD_SECURITY_CONTEXT pContext,
@@ -441,80 +209,6 @@ find_module_api(
     goto cleanup;
 }
 
-uint32_t
-check_access_uid_gid(
-    PPMD_SECURITY_CONTEXT pContext,
-    uid_t uid,
-    gid_t gid,
-    const char *pszModule,
-    const char *pszApiName
-    )
-{
-    uint32_t dwError = 0;
-    NTSTATUS status = STATUS_SUCCESS;
-    PPMD_API_SECURITY pApiSecurity = NULL;
-    PACCESS_TOKEN pToken = NULL;
-    ACCESS_MASK AccessDesired = FILE_GENERIC_READ;
-    ACCESS_MASK AccessMask = 0;
-
-    GENERIC_MAPPING stMapping =
-    {
-        .GenericRead    = FILE_GENERIC_READ,
-        .GenericWrite   = FILE_GENERIC_WRITE,
-        .GenericExecute = FILE_GENERIC_EXECUTE,
-        .GenericAll     = FILE_ALL_ACCESS
-    };
-
-
-    if(!pContext ||
-       IsNullOrEmptyString(pszModule) ||
-       IsNullOrEmptyString(pszApiName))
-    {
-        dwError = ERROR_PMD_INVALID_PARAMETER;
-        BAIL_ON_PMD_ERROR(dwError);
-    }
-
-    dwError = find_module_api(pContext, pszModule, pszApiName, &pApiSecurity);
-    BAIL_ON_PMD_ERROR(dwError);
-
-    if(!pApiSecurity->pSecAbs)
-    {
-        dwError = init_security_abs(pContext, pApiSecurity);
-        BAIL_ON_PMD_ERROR(dwError);
-    }
-
-    dwError = LwMapSecurityCreateAccessTokenFromUidGid(
-                  pContext->pSecContext,
-                  &pToken,
-                  uid,
-                  gid);
-    BAIL_ON_PMD_ERROR(dwError);
-
-    if(!RtlAccessCheck(pApiSecurity->pSecAbs,
-                      pToken,
-                      AccessDesired,
-                      0,
-                      &stMapping,
-                      &AccessMask,
-                      &status))
-    {
-        fprintf(stderr,
-                "API Access denied. User: %d, Group: %d, Module: %s Api: %s",
-                uid,
-                gid,
-                pszModule,
-                pszApiName);
-        dwError = ERROR_PMD_ACCESS_DENIED;
-        BAIL_ON_PMD_ERROR(dwError);
-    }
-
-cleanup:
-    return dwError;
-
-error:
-    goto cleanup;
-}
-
 void
 free_api_security(
     PPMD_API_SECURITY pApiSecurity
diff --git a/server/security/includes.h b/server/security/includes.h
index 96f5dfb..b310062 100644
--- a/server/security/includes.h
+++ b/server/security/includes.h
@@ -16,9 +16,6 @@
 #pragma once
 #include <stdint.h>
 
-#include <lw/base.h>
-#include <lw/types.h>
-
 #include "../../common/includes.h"
 #include <dce/dcethread.h>
 #include <dce/lrpc.h>
diff --git a/server/security/prototypes.h b/server/security/prototypes.h
index 7ec3b5e..dd33469 100644
--- a/server/security/prototypes.h
+++ b/server/security/prototypes.h
@@ -21,14 +21,6 @@ init_module_security(
     PPMD_MODULE_SECURITY *ppModuleSecurity
     );
 
-uint32_t
-check_access_uid_gid(
-    PPMD_SECURITY_CONTEXT pContext,
-    uid_t uid,
-    gid_t gid,
-    const char *psModuleName,
-    const char *pszApiName
-    );
 
 void
 free_api_security(
diff --git a/server/security/structs.h b/server/security/structs.h
index f6a6ab6..8ecd2c0 100644
--- a/server/security/structs.h
+++ b/server/security/structs.h
@@ -19,7 +19,6 @@ typedef struct _PMD_API_SECURITY_
 {
     char *pszName;
     char *pszSDDL;
-    PSECURITY_DESCRIPTOR_ABSOLUTE pSecAbs;
     struct _PMD_API_SECURITY_ *pNext;
 }PMD_API_SECURITY, *PPMD_API_SECURITY;
 
@@ -32,6 +31,5 @@ typedef struct _PMD_MODULE_SECURITY_
 
 typedef struct _PMD_SECURITY_CONTEXT_
 {
-    PLW_MAP_SECURITY_CONTEXT pSecContext;
     PPMD_MODULE_SECURITY pModuleSecurity;
 }PMD_SECURITY_CONTEXT, *PPMD_SECURITY_CONTEXT;
diff --git a/server/utils.c b/server/utils.c
index 38713b0..4a0a6c5 100644
--- a/server/utils.c
+++ b/server/utils.c
@@ -90,7 +90,7 @@ PPMDGetCanonicalHostName(
     }
     else
     {
-        dwError = ERROR_NO_DATA;
+        dwError = ERROR_PMD_NO_DATA;
     }
     BAIL_ON_PMD_ERROR(dwError);
 
diff --git a/tools/cli/Makefile.am b/tools/cli/Makefile.am
index 1c9b93c..b660bcc 100644
--- a/tools/cli/Makefile.am
+++ b/tools/cli/Makefile.am
@@ -32,5 +32,4 @@ if ENABLE_DEMO
 endif
 
 pmd_cli_LDFLAGS = \
-    @DCERPC_LDFLAGS@ \
-    @LW_LDFLAGS@
+    @DCERPC_LDFLAGS@
diff --git a/tools/cli/demo/Makefile.am b/tools/cli/demo/Makefile.am
index 0e8dda0..1fb452d 100644
--- a/tools/cli/demo/Makefile.am
+++ b/tools/cli/demo/Makefile.am
@@ -1,6 +1,6 @@
 noinst_LTLIBRARIES = libdemocli.la
 
-libdemocli_la_CPPFLAGS = -I$(top_srcdir)/include -I$(top_srcdir)/idl -I/opt/likewise/include 
+libdemocli_la_CPPFLAGS = -I$(top_srcdir)/include -I$(top_srcdir)/idl
 libdemocli_la_SOURCES = \
     demo_help.c \
     demo_main.c \
diff --git a/tools/cli/fwmgmt/Makefile.am b/tools/cli/fwmgmt/Makefile.am
index fc28d78..5ac20f0 100644
--- a/tools/cli/fwmgmt/Makefile.am
+++ b/tools/cli/fwmgmt/Makefile.am
@@ -2,8 +2,7 @@ noinst_LTLIBRARIES = libfwmgmtcli.la
 
 libfwmgmtcli_la_CPPFLAGS = \
     -I$(top_srcdir)/include \
-    -I$(top_srcdir)/idl \
-    -I/opt/likewise/include 
+    -I$(top_srcdir)/idl
 
 libfwmgmtcli_la_SOURCES = \
     fwmgmt_help.c \
diff --git a/tools/cli/netmgmt/Makefile.am b/tools/cli/netmgmt/Makefile.am
index 3e5c838..fcb2850 100644
--- a/tools/cli/netmgmt/Makefile.am
+++ b/tools/cli/netmgmt/Makefile.am
@@ -1,6 +1,6 @@
 noinst_LTLIBRARIES = libnetmgmtcli.la
 
-libnetmgmtcli_la_CPPFLAGS = -I$(top_srcdir)/include -I$(top_srcdir)/idl -I/opt/likewise/include -I/usr/include/netmgmt
+libnetmgmtcli_la_CPPFLAGS = -I$(top_srcdir)/include -I$(top_srcdir)/idl -I/usr/include/netmgmt
 libnetmgmtcli_la_SOURCES = \
     net_help.c \
     net_main.c
diff --git a/tools/cli/rolemgmt/Makefile.am b/tools/cli/rolemgmt/Makefile.am
index 3670d60..3702784 100644
--- a/tools/cli/rolemgmt/Makefile.am
+++ b/tools/cli/rolemgmt/Makefile.am
@@ -2,8 +2,7 @@ noinst_LTLIBRARIES = librolemgmtcli.la
 
 librolemgmtcli_la_CPPFLAGS = \
     -I$(top_srcdir)/include \
-    -I$(top_srcdir)/idl \
-    -I/opt/likewise/include 
+    -I$(top_srcdir)/idl
 
 librolemgmtcli_la_SOURCES = \
     rolemgmt_help.c \
diff --git a/tools/cli/usermgmt/Makefile.am b/tools/cli/usermgmt/Makefile.am
index 1196fa2..e507d91 100644
--- a/tools/cli/usermgmt/Makefile.am
+++ b/tools/cli/usermgmt/Makefile.am
@@ -2,8 +2,7 @@ noinst_LTLIBRARIES = libusermgmtcli.la
 
 libusermgmtcli_la_CPPFLAGS = \
     -I$(top_srcdir)/include \
-    -I$(top_srcdir)/idl \
-    -I/opt/likewise/include 
+    -I$(top_srcdir)/idl
 
 libusermgmtcli_la_SOURCES = \
     usermgmt_help.c \
diff --git a/tools/pmd.spec.in b/tools/pmd.spec.in
deleted file mode 100644
index f46b1cf..0000000
--- a/tools/pmd.spec.in
+++ /dev/null
@@ -1,285 +0,0 @@
-#
-# pmd spec file
-#
-
-%define _mech_file /etc/gss/mech
-%define _mech_id 1.3.6.1.4.1.6876.11711.2.1.2
-%define _python3_sitearch %(python3 -c "from distutils.sysconfig import get_python_lib; import sys; sys.stdout.write(get_python_lib(1))")
-
-Summary:	Photon Management Daemon
-Name:		pmd
-Version:	@VERSION@
-Release:	2%{?dist}
-Vendor:		VMware, Inc.
-Distribution:	Photon
-License:	VMware
-Url:		http://www.vmware.com
-Group:		Applications/System
-Requires:	likewise-open >= 6.2.9
-Requires:       netmgmt >= 1.0.4-11
-Requires:	systemd
-Requires:	tdnf >= 1.2.0-4
-Requires:	vmware-rest >= 1.0.0-3
-Requires:       vmware-afd-client
-Requires:       vmware-directory-client
-Requires:       jansson
-Requires:       copenapi >= 0.1-6
-BuildRequires:	popt-devel
-BuildRequires:	rpm-devel
-BuildRequires:	tdnf-devel >= 1.2.0-4
-BuildRequires:	vmware-rest-devel >= 1.0.0-3
-BuildRequires:  vmware-afd-client-devel
-BuildRequires:  vmware-directory-client-devel
-BuildRequires:	netmgmt-devel >= 1.0.4-11
-BuildRequires:  jansson-devel
-BuildRequires:  copenapi-devel >= 0.1-6
-Source0:	%{name}-%{version}.tar.gz
-
-%description
-Photon Management Daemon
-
-%package cli
-BuildRequires:	netmgmt-cli-devel >= 1.0.4-2
-Summary: photon management daemon cmd line cli
-Requires: likewise-open >= 6.2.0
-Requires: vmware-directory-client
-
-%description cli
-photon management daemon cmd line cli
-
-%package devel
-Summary: photon management daemon client devel
-Group: Development/Libraries
-
-%description devel
-photon management daemon client devel
-
-%package python2
-Summary: Python2 bindings for photon management daemon
-Group: Development/Libraries
-Requires: python2 >= 2.7
-Requires: %{name}-cli = %{version}-%{release}
-BuildRequires: python2-devel >= 2.7
-
-%description python2
-Python2 bindings for photon management daemon
-
-%package python3
-Summary: Python3 bindings for photon management daemon
-Group: Development/Libraries
-Requires: python3 >= 3.5
-Requires: %{name}-cli = %{version}-%{release}
-BuildRequires: python3-devel >= 3.5
-
-%description python3
-Python3 bindings for photon management daemon
-
-%prep
-%setup -q
-
-%build
-cd $RPM_BUILD_DIR/%{name}-%{version}
-autoreconf -mif
-./configure \
-    --prefix=%{_prefix} \
-    --bindir=%{_bindir} \
-    --libdir=%{_libdir} \
-    --sysconfdir=/etc \
-    --with-likewise=/opt/likewise \
-    --with-vmware-rest=/usr/lib \
-    --enable-python=no \
-    --disable-static
-make clean
-make
-
-pushd python
-python2 setup.py build
-python3 setup.py build
-popd
-
-%install
-cd $RPM_BUILD_DIR/%{name}-%{version}
-make DESTDIR=%{buildroot} install
-rm -f %{buildroot}%{_libdir}/*.la
-
-pushd python
-python2 setup.py install --skip-build --root %{buildroot}
-rm -f %{buildroot}%{python_sitearch}/pmd.so
-python3 setup.py install --skip-build --root %{buildroot}
-popd
-
-install -d $RPM_BUILD_ROOT/var/log/pmd
-install -D -m 444 pmd.service %{buildroot}/lib/systemd/system/pmd.service
-install -D -m 444 restconf/restapispec.json %{buildroot}/etc/pmd/restapispec.json
-install -D -m 444 api_sddl.conf %{buildroot}/etc/pmd/api_sddl.conf
-install -D -m 444 restconf/restconfig.txt %{buildroot}/etc/pmd/restconfig.txt
-install -D -m 444 restconf/server.crt  %{buildroot}/etc/pmd/server.crt
-install -D -m 444 restconf/server.key %{buildroot}/etc/pmd/server.key
-install -d $RPM_BUILD_ROOT/etc/pmd.roles.d
-install -d $RPM_BUILD_ROOT/etc/pmd.roles.plugins.d
-install -D -m 444 example.role %{buildroot}/etc/pmd.roles.d/example.role
-
-# Pre-install
-%pre
-
-    # First argument is 1 => New Installation
-    # First argument is 2 => Upgrade
-
-# Post-install
-%post
-
-    # First argument is 1 => New Installation
-    # First argument is 2 => Upgrade
-    sed -i "s/IPADDRESS_MARKER/`ifconfig eth0 | grep -Eo 'inet (addr:)?([0-9]*\.){3}[0-9]*' | grep -Eo '([0-9]*\.){3}[0-9]*' | grep -v '127.0.0.1'`/g" /etc/pmd/restapispec.json
-    /sbin/ldconfig
-    %systemd_post pmd.service
-    systemctl daemon-reload
-    systemctl restart pmd
-    #open port 81 for REST server
-    iptables -A INPUT -p tcp --dport 81 -j ACCEPT
-    #open port 2016 for dcerpc server
-    iptables -A INPUT -p tcp --dport 2016 -j ACCEPT
-    #persist firewall info
-
-    if [ ! -d "%{_libdir}/gss" ] ; then
-        mkdir %{_libdir}/gss
-    fi
-
-    # Add libgssapi_unix.so to GSSAPI plugin directory
-    if [ ! -h %{_libdir}/gss/libgssapi_unix.so ]; then
-        /bin/ln -sf /opt/vmware/lib64/libgssapi_unix.so %{_libdir}/gss/libgssapi_unix.so
-    fi
-    # Add gssapi_unix plugin configuration to GSS mech file
-    if [ -f "%{_mech_file}" ]; then
-        if [ `grep -c "%{_mech_id}" "%{_mech_file}"` -lt 1 ]; then
-            echo "unix %{_mech_id} libgssapi_unix.so" >> "%{_mech_file}"
-        fi
-    fi
-
-# Pre-uninstall
-%preun
-
-    # First argument is 0 => Uninstall
-    # First argument is 1 => Upgrade
-    %systemd_preun pmd.service
-if [ "$1" = 0 ]; then
-    if [ ! -e %{_bindir}/pmd-cli ]; then
-        # Cleanup GSSAPI UNIX symlink
-        if [ -h %{_libdir}/gss/libgssapi_unix.so ]; then
-            rm -f %{_libdir}/gss/libgssapi_unix.so
-        fi
-        # Remove GSSAPI SRP plugin configuration from GSS mech file
-        if [ -f "%{_mech_file}" ]; then
-            if [ `grep -c  "%{_mech_id}" "%{_mech_file}"` -gt 0 ]; then
-                cat "%{_mech_file}" | sed '/%{_mech_id}/d' > "/tmp/mech-$$"
-                if [ -s /tmp/mech-$$ ]; then
-                    mv "/tmp/mech-$$" "%{_mech_file}"
-                fi
-            fi
-        fi
-    fi
-fi
-
-
-# Post-uninstall
-%postun
-
-    /sbin/ldconfig
-
-    # First argument is 0 => Uninstall
-    # First argument is 1 => Upgrade
-    %systemd_postun_with_restart pmd.service
-
-# Post pmd-cli
-%post cli
-    if [ ! -d "%{_libdir}/gss" ] ; then
-        mkdir %{_libdir}/gss
-    fi
-
-    # Add libgssapi_unix.so to GSSAPI plugin directory
-    if [ ! -h %{_libdir}/gss/libgssapi_unix.so ]; then
-        /bin/ln -sf /opt/vmware/lib64/libgssapi_unix.so %{_libdir}/gss/libgssapi_unix.so
-    fi
-    # Add gssapi_unix plugin configuration to GSS mech file
-    if [ -f "%{_mech_file}" ]; then
-        if [ `grep -c "%{_mech_id}" "%{_mech_file}"` -lt 1 ]; then
-            echo "unix %{_mech_id} libgssapi_unix.so" >> "%{_mech_file}"
-        fi
-    fi
-
-# Pre-uninstall cli
-%preun cli
-
-    # First argument is 0 => Uninstall
-    # First argument is 1 => Upgrade
-
-if [ "$1" = 0 ]; then
-    if [ ! -e %{_bindir}/pmd ]; then
-        # Cleanup GSSAPI UNIX symlink
-        if [ -h %{_libdir}/gss/libgssapi_unix.so ]; then
-            rm -f %{_libdir}/gss/libgssapi_unix.so
-        fi
-        # Remove GSSAPI SRP plugin configuration from GSS mech file
-        if [ -f "%{_mech_file}" ]; then
-            if [ `grep -c  "%{_mech_id}" "%{_mech_file}"` -gt 0 ]; then
-                cat "%{_mech_file}" | sed '/%{_mech_id}/d' > "/tmp/mech-$$"
-                if [ -s /tmp/mech-$$ ]; then
-                    mv "/tmp/mech-$$" "%{_mech_file}"
-                fi
-            fi
-        fi
-    fi
-fi
-# Post-uninstall
-%postun cli
-    /sbin/ldconfig
-
-%clean
-rm -rf %{buildroot}/*
-
-%files
-    %defattr(-,root,root,0755)
-    %{_bindir}/pmd
-    /lib/systemd/system/pmd.service
-    /etc/pmd/pmd.conf
-    /etc/pmd/api_sddl.conf
-    /etc/pmd/restapispec.json
-    /etc/pmd/restconfig.txt
-    /etc/pmd/server.crt
-    /etc/pmd/server.key
-    /etc/pmd.roles.d/example.role
-    %dir /var/log/pmd
-    %dir /etc/pmd.roles.plugins.d
-
-%files cli
-    %{_bindir}/pmd-cli
-    %{_libdir}/libpmdclient.so.*
-
-%files devel
-    %{_includedir}/pmd/*.h
-    %{_libdir}/libpmdclient.so
-    %{_libdir}/pkgconfig/pmdclient.pc
-
-%files python2
-    %{python_sitearch}/%{name}/
-    %{python_sitearch}/%{name}_python-*.egg-info
-
-%files python3
-    %{_python3_sitearch}/%{name}/
-    %{_python3_sitearch}/%{name}_python-*.egg-info
-
-%changelog
-*       Thu Jan 12 2017 Priyesh Padmavilasom <ppadmavilasom@vmware.com> 0.93-5
--       split python2 and python3 packages. cleanup dependencies
-*       Tue Oct 4 2016 Priyesh Padmavilasom <ppadmavilasom@vmware.com> 0.9-6
--       use copenapi for REST
-*       Fri Aug 19 2016 Priyesh Padmavilasom <ppadmavilasom@vmware.com> 0.9-3
--       python bindings initial
-*       Wed Aug 3 2016 Priyesh Padmavilasom <ppadmavilasom@vmware.com> 0.6
--       http basic and negotiate auth, gssapi_srp auth
-*       Mon Jul 25 2016 Priyesh Padmavilasom <ppadmavilasom@vmware.com> 0.4
--       cmd line fixes for localhost access, error descriptions
-*       Fri Jul 08 2016 Priyesh Padmavilasom <ppadmavilasom@vmware.com> 0.2
--       Integration with netmgmt, tdnf, gssapi_unix
-*       Mon Jun 27 2016 Priyesh Padmavilasom <ppadmavilasom@vmware.com> 0.1
--       Initial build.  First version
