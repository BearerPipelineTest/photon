- removed version string change from src/version.c
From 15d9890eee53afc61eb0a03b878a19cb5672f732 Mon Sep 17 00:00:00 2001
From: Bram Moolenaar <Bram@vim.org>
Date: Thu, 4 Nov 2021 15:46:05 +0000
Subject: [PATCH] patch 8.2.3582: reading uninitialized memory when giving
 spell suggestions

Problem:    Reading uninitialized memory when giving spell suggestions.
Solution:   Check that preword is not empty.
---
 src/spellsuggest.c         | 2 +-
 src/testdir/test_spell.vim | 8 ++++++++
 src/version.c              | 2 ++
 3 files changed, 11 insertions(+), 1 deletion(-)

diff --git a/src/spell.c b/src/spell.c
index ed0db8c..ec0eb7a 100644
--- a/src/spell.c
+++ b/src/spell.c
@@ -4747,7 +4747,7 @@ suggest_trie_walk(
 		     * char, e.g., "thes," -> "these". */
 		    p = fword + sp->ts_fidx;
 		    MB_PTR_BACK(fword, p);
-		    if (!spell_iswordp(p, curwin))
+		    if (!spell_iswordp(p, curwin) && *preword != NUL)
 		    {
 			p = preword + STRLEN(preword);
 			MB_PTR_BACK(preword, p);
diff --git a/src/testdir/test_spell.vim b/src/testdir/test_spell.vim
index e6c3729..92d1133 100644
--- a/src/testdir/test_spell.vim
+++ b/src/testdir/test_spell.vim
@@ -18,3 +18,11 @@ func Test_wrap_search()
   bwipe!
   set nospell
 endfunc
+
+func Test_spell_single_word()
+  new
+  silent! norm 0R00
+  spell! ßÂ
+  silent 0norm 0r$ Dvz=
+  bwipe!
+endfunc
